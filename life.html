<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Life Auto Loop with Progress</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#000; font-family:sans-serif; }

  /* ===== 桌面端转盘 ===== */
  #my-life { position:relative; width:100vw; height:100vh; overflow:hidden; }

  .life-item {
    position:absolute;
    top:50%;
    left:50%;
    width:320px;
    height:570px;
    transform-origin:center;
    transition: transform 0.35s ease, opacity 0.35s ease, filter 0.35s ease;
  }
  .life-item video,
  .life-item img { width:100%; height:100%; object-fit:cover; border-radius:6px; }

  /* 左右箭头 */
  .arrow {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:60px;
    color:rgba(255,255,255,0.3);
    cursor:pointer;
    user-select:none;
    z-index:50;
    transition: color 0.2s;
  }
  .arrow:hover { color:rgba(255,255,255,0.7); }
  .arrow-left { left:20px; }
  .arrow-right { right:20px; }

  /* ===== 进度条 ===== */
  #progress-container {
    position:absolute;
    top:10px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:5px;
    width:90%;
    max-width:600px;
    z-index:100;
  }
  .progress-bar { flex:1; height:4px; background:rgba(255,255,255,0.3); border-radius:2px; overflow:hidden; }
  .progress-bar-inner { height:100%; width:0%; background:#fff; transition: width linear; }

  /* ===== 手机 Story 模式 ===== */
  @media(max-width:768px){
    body{ overflow:hidden; }
    #my-life{ display:block; width:100vw; height:100vh; position:fixed; top:0; left:0; }

    .life-item{
      position:fixed !important;
      top:0;
      left:0;
      width:100vw;
      height:100vh;
      transform:none !important;
      opacity:0;
      transition:opacity 0.5s ease;
      z-index:0;
    }
    .life-item.active{ opacity:1; z-index:10; }

    .arrow{ display:none; }
    #progress-container{ top:5px; }
}

</style>
</head>
<body>

<div id="my-life">
  <!-- 内容 -->
  <div class="life-item"><video src="images/life/gameday.MOV" muted loop playsinline></video></div>
  <div class="life-item"><img src="images/life/reneegolf.JPG" /></div>
  <div class="life-item"><video src="images/life/thanksgiving.MOV" muted loop playsinline></video></div>
  <div class="life-item"><img src="images/life/cherry.JPG" /></div>
  <div class="life-item"><img src="images/life/asm.JPG" /></div>
  <div class="life-item"><img src="images/life/chicago.JPG" /></div>

  <!-- 左右箭头 -->
  <div class="arrow arrow-left">&#10094;</div>
  <div class="arrow arrow-right">&#10095;</div>

  <!-- 进度条 -->
  <div id="progress-container"></div>
</div>

<script>
const items = document.querySelectorAll('.life-item');
const progressContainer = document.getElementById('progress-container');
let activeIndex = 0;
const total = items.length;
let isScrolling = false;
const autoInterval = 5000; // 5秒
let progressTimer;
let autoTimer;

// ===== 初始化进度条 =====
items.forEach(()=> {
  const bar = document.createElement('div');
  bar.className='progress-bar';
  const inner = document.createElement('div');
  inner.className='progress-bar-inner';
  bar.appendChild(inner);
  progressContainer.appendChild(bar);
});
const progressBars = document.querySelectorAll('.progress-bar-inner');

// ===== 桌面端转盘布局 =====
function updateDesktop() {
  items.forEach((item,index)=>{
    let offset = ((index - activeIndex + total) % total);
    if(offset > total/2) offset -= total;

    const scale = offset===0?1:0.7;
    const translateX = offset*240;
    const translateY = -50;
    const opacity = Math.abs(offset)>2?0:0.6;
    const blur = offset===0?'none':'blur(2px)';
    const zIndex = 10-Math.abs(offset);

    item.style.transform = `translate(-50%,${translateY}%) translateX(${translateX}px) scale(${scale})`;
    item.style.opacity = offset===0?1:opacity;
    item.style.filter = blur;
    item.style.zIndex = zIndex;

    const video = item.querySelector('video');
    if(video) offset===0?video.play():video.pause();
  });

  // 更新进度条
  progressBars.forEach((bar,i)=>{
    bar.style.transition='none';
    bar.style.width=i<activeIndex?'100%':'0%';
  });
  requestAnimationFrame(()=> {
    const currentBar=progressBars[activeIndex];
    currentBar.style.transition=`width ${autoInterval}ms linear`;
    currentBar.style.width='100%';
  });
}

// ===== 手机 Story 更新 =====
function updateMobile() {
  items.forEach((item,i)=>{
    if(i===activeIndex){
      item.classList.add('active');
      const video=item.querySelector('video');
      if(video) video.play();
    } else {
      item.classList.remove('active');
      const video=item.querySelector('video');
      if(video) video.pause();
    }
  });
}

// ===== 自动切换 =====
function startAutoPlay() {
  clearInterval(autoTimer);
  autoTimer=setInterval(()=>{ nextItem(); }, autoInterval);
}

// ===== 切换逻辑 =====
function nextItem(){
  activeIndex=(activeIndex+1)%total;
  if(window.innerWidth>768) updateDesktop(); else updateMobile();
  startAutoPlay();
}
function prevItem(){
  activeIndex=(activeIndex-1+total)%total;
  if(window.innerWidth>768) updateDesktop(); else updateMobile();
  startAutoPlay();
}

// ===== 事件绑定 =====
// 桌面滚轮
window.addEventListener('wheel',(e)=>{
  if(window.innerWidth<768) return;
  if(isScrolling) return;

  if(e.deltaY>0) nextItem();
  if(e.deltaY<0) prevItem();

  isScrolling=true;
  setTimeout(()=>isScrolling=false,150);
});
// 左右箭头
document.querySelector('.arrow-left').addEventListener('click',prevItem);
document.querySelector('.arrow-right').addEventListener('click',nextItem);
// 键盘
window.addEventListener('keydown',(e)=>{
  if(e.key==='ArrowRight') nextItem();
  else if(e.key==='ArrowLeft') prevItem();
});

// ===== 初始化 =====
if(window.innerWidth>768) updateDesktop();
else updateMobile();
startAutoPlay();

// ===== 手机端触控滑动 =====
let startY=0;
let endY=0;
window.addEventListener('touchstart',e=>{ startY=e.touches[0].clientY; });
window.addEventListener('touchend',e=>{
  endY=e.changedTouches[0].clientY;
  if(startY-endY>50) nextItem(); // 上滑
  if(endY-startY>50) prevItem(); // 下滑
});
</script>

</body>
</html>
